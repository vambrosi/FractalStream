viewers:
  - title: Mandelbrot set

    width_pixels: 700
    height_pixels: 700

    projective: true
    coord: c

    center_x: -0.5
    center_y: 0.0
    width: 4.0

    max_iterations: 300
    escape_radius: 100.0
    convergence_radius: 1e-4

    code: |
      vec4 z = vec4(0.0, 0.0, 1.0, 0.0);
      const vec4 infinity = vec4(1.0, 0.0, 0.0, 0.0);

      color = vec4(0.0, 0.0, 0.0, 1.0);

      for (int iter = 0; iter < _max_iterations; iter++) {
        if (_pDist(z, infinity) < _convergence_radius) {
          float d = _pDist(z, infinity);
          float depth = fract((float(iter) - log2(-log(d))) / 32.0);
          color = texture(uTexture, depth);
          break;
        }

        z = _pAdd(_pMul(z, z), c);
      }