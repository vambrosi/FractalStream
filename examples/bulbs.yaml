viewer:
  title: Mandelbrot set
  style: complex-plane
  size: 512x512
  resizable: true
  z-coord: C
  initial-center: 0
  initial-pixel-size: 1/128
  code: |
      # We want to follow the critical point
      z : C <- 0

      # Iterate until z escapes or we repeat max_iters times
      k : Z <- 0
      while k < max_iters and |z| < escape_radius
        z <- z^2 + C
        k <- k + 1

      # Color points that failed to escape black, and
      # for other points use a gradient between red and yellow.
      if k = max_iters then
        color <- black
      else
        color <- cycle (k / 20, red, yellow)

  tools:
    - name: Bulb info
      shortcut: b
      configuration:
        title: Period of bulb
        size: 400x200
        vertical-contents:
          - panel:
              title: "Result"
              vertical-contents:
                - text-entry:
                    label: "Period = "
                    value: "0"
                    type: Z
                    variable: period
          - panel:
              title: "Settings"
              vertical-contents:
                - text-entry:
                    label: "Warmup iterations"
                    value: "10000"
                    type: Z
                    variable: warmup
                - text-entry:
                    label: "Tolerance"
                    value: "0.0001"
                    type: R
                    variable: tolerance
                - text-entry:
                    label: "Maximum period"
                    value: "1000"
                    type: Z
                    variable: max_period

      actions:
        - event: click
          code: |
            period <- 0

            z : C <- 0
            k : Z <- 0
            while k < warmup and |z| < escape_radius
              k <- k + 1
              z <- z^2 + C

            if k = warmup then
              target : C <- z
              k <- 0
              while k < max_period
                k <- k + 1
                z <- z^2 + C
                if |z - target| < tolerance then
                  period <- k
                  k <- max_period



configuration:
  title: Configuration
  size: 400x200
  vertical-contents:
    - text-entry:
        label: "Max. iterations:"
        value: "100"
        type: Z
        variable: max_iters
    - text-entry:
        label: "Escape radius:"
        value: 10
        type: R
        variable: escape_radius
