# This is a translation of the "Xavier's Exceptional Divisors"
# script from the original FractalStream.
viewers:
  - title: t-plane
    style: complex-plane
    size: 512x512
    resizable: true
    z-coord: t
    iteration-limit: maxIters
    vanishing-radius: tol
    escape-radius: escape
    initial-center: 0
    initial-pixel-size: 1/128
    code: |
      while t^3 != 1:
        t <- t (2 + t^3) / (2 t^3 + 1)

      if t = 1:
        color <- tcolor1
      else if t = -1/2 + i sqrt(3) / 2:
        color <- tcolor2
      else if t = -1/2 - i sqrt(3) / 2:
        color <- tcolor3
      else:
        color <- black

  - title: z-plane
    style: complex-plane
    size: 512x512
    resizable: true
    z-coord: z
    iteration-limit: maxIters
    vanishing-radius: tol
    escape-radius: escape
    initial-center: 0
    initial-pixel-size: 1/128
    code: |
      y : C <- 0.5 / z
      x : C <- 0.5 * t / z

      j : C <- -1/2 + i sqrt(3) / 2
      jbar : C <- -1/2 - i sqrt(3) / 2

      until x = 0 or x^3 = -1 or x^3 = 1/8:
        w : C <- -3 x (2 y^3 + x^3) / ((1 - 6 x y) - 4 (x^3 + y^3) + 6 x^2 y^2)
        y <- -3 y (2 x^3 + y^3) / ((1 - 6 x y) - 4 (x^3 + y^3) + 6 x^2 y^2)
        x <- w

      if x = 0:
        color <- zcol
      else if x = -1:
        w : C <- (y + 1) / (x - y)
        iterate w -> 2 w^3 / 3 + w^2 + 2w + 1/3 until ...
          w escapes or w = j or w = jbar

        if w escaped:
          color <- color8
        else if w = j:
          color <- color9
        else if w = jbar:
          color <- color10
        else:
          color <- black
      else if x = -j:
        w : C <- (y / jbar + 1)/(x/j - y/jbar)
        iterate w -> 2 w^3 / 3 + w^2 + 2w + w/3 until ...
          w escapes or w = j or w = jbar
        if w escapes:
          color <- color8
        else if w = j:
          color <- color9
        else if w = jbar:
          color <- color10
        else:
          color <- black
      else if x = -jbar:
        w : C <- (y/j + 1) / (x/jbar - y/j)
        iterate w ->  2 w^3 / 3 + w^2 + 2w + 1/3 until ...
          w escapes or w = j or j = jbar
        if w escapes:
          color <- color8
        else if w = j:
          color <- color9
        else if w = jbar:
          color <- color10
        else:
          color <- black
      else if x^3 = 1/8:
        color <- exceptional
      else:
        color <- black

configuration:
  title: Configuration
  size: 400x200
  vertical-contents:
    - panel:
        title: Configuration
        vertical-contents:
          - text-entry:
              label: "Iteration limit"
              value: "100"
              type: Z
              variable: maxIters
          - text-entry:
              label: "Escape radius"
              value: "10"
              type: R
              variable: escape
          - text-entry:
              label: "Tolerance"
              value: "0.01"
              type: R
              variable: tol
          - text-entry:
              label: "t = "
              value: "1+i"
              type: C
              variable: t
    - panel:
        title: t-plane colors
        vertical-contents:
          - color-picker:
              label: "1"
              value: red
              variable: tcolor1
          - color-picker:
              label: "ω"
              value: green
              variable: tcolor2
          - color-picker:
              label: "ω²"
              value: blue
              variable: tcolor3
    - panel:
        title: z-plane colors
        vertical-contents:
          - color-picker:
              label: "escaped"
              value: yellow
              variable: zcol
          - color-picker:
              label: "inf"
              value: red
              variable: color8
          - color-picker:
              label: "j"
              value: green
              variable: color9
          - color-picker:
              label: "jbar"
              value: blue
              variable: color10
          - color-picker:
              label: "exceptional"
              value: rgb(1,0.7,0.7)
              variable: exceptional
